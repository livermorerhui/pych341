# 解决 CH341 通过 pych341 控制 AD9833 的通信问题（L）

踩了太多坑了，快要搞死我，终于将控制代码写好。
- 能准确地输出特定频率的波形
  - 直接用pych341，虽然能控制CH341，但它的SPI的通讯与AD9833的不完全一致，导致AD9833接收到指令与数据手册的不一致
  
我写了两个文件：main_program.py和ch341_spi.py。这两个结合使用，通过 CH341的SPI发送的指令 和 AD9833的数据手册的一致
- ch341_spi.py：创建软件模拟 SPI 库，规范通讯，做到与 AD9833要求的一致
  - 因为 pych341 库并没有提供修改 SPI 模式的接口，其底层 CH341 芯片的硬件 SPI 很可能固定在 Mode 0 或 Mode 3，导致 AD9833 接收到的所有数据都是错误的，因此无法解析正确的频率和波形命令
  - 既然 pych341 的硬件 SPI 功能无法配置模式，我决定绕过它，利用其 GPIO 功能在软件层面完全模拟出 SPI_MODE2 的时序，这样就能解决数据接收错误的问题。
- main_program.py：交互式界面，可设定频率和波形
  - 包含经过完全重构的 AD9833 控制类和功能完善的交互式界面。它通过 ch341_spi.py 来确保与 AD9833 的通信完全符合数据手册要求。
---
# PyCh341

*注意：本库尚在开发中，API可能频繁变化*

CH341 是一个 USB 总线的转接芯片，通过 USB 总线提供异步串口、打印口、并口以及常用的 2 线和 4 线等同步串行接口。  

本库提供ch341 API的python绑定，底层API由WCH提供，详见[https://www.wch.cn/](https://www.wch.cn/)。

*注意（L）*
*解压安装后，ch341.py里的 class 名称为 Ch341。因为在引用的时候，正确写法是这样的`from ch341 import Ch341`，AI给的代码可能是这么写的`from ch341 import CH341`*

### 安装
1. 解压，然后放到项目的文件夹里（L）
2. 终端切换到项目文件夹，执行安装（L）
```
python setup.py install
```
Ps：安装的方法不止一种，可自行搜索（L）
### 版本依赖
- python 3.9+

### 开发进度

**功能**
- [x] i2c
- [x] spi
- [x] gpio
- [x] 中断回调

**例程**
- [x] mpu6050例程
- [ ] ssd1306例程
- [x] at24cXX例程

**平台支持**
- [x] Windows
- [ ] Linux


